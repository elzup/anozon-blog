{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/firebase-messaging-by-function","result":{"data":{"site":{"siteMetadata":{"title":"あのぞんブログ","author":"anozon","siteUrl":"https://blog.anozon.me"}},"markdownRemark":{"id":"ce72bda1-ed15-57dd-849a-6c01f9064056","excerpt":"Firebase Function から Cloud Messaging (FCM HTTP v1 API) を使って通知を送る方法のメモです。  の初期化設定する アプリサーバーからの送信リクエストを作成する  |  Firebase (公式ドキュメント) 「 が必要なの？」とか「 ADC…","html":"<p>Firebase Function から Cloud Messaging (FCM HTTP v1 API) を使って通知を送る方法のメモです。</p>\n<h2 id=\"firebase-admin-の初期化設定する\" style=\"position:relative;\"><code class=\"language-text\">firebase-admin</code> の初期化設定する</h2>\n<p><a href=\"https://firebase.google.com/docs/cloud-messaging/send-message?hl=ja\">アプリサーバーからの送信リクエストを作成する  |  Firebase</a> (公式ドキュメント)</p>\n<!-- textlint-disable ja-technical-writing/sentence-length  -->\n<p>「<code class=\"language-text\">GOOGLE_APPLICATION_CREDENTIALS</code> が必要なの？」とか「 ADC はどうやって承認するの？」とか「Authorization ヘッダにどの Token をセットするの？」とか少しややこしかった。</p>\n<!-- textlint-enable ja-technical-writing/sentence-length -->\n<p>結論から言うと <strong>Firebase Function にデプロイする場合は何も考えなくていい</strong>。\n以下のコードで暗黙的に検出される。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">admin<span class=\"token punctuation\">.</span><span class=\"token function\">initializeApp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  credential<span class=\"token operator\">:</span> admin<span class=\"token punctuation\">.</span>credential<span class=\"token punctuation\">.</span><span class=\"token function\">applicationDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"functionsindexjs-のコード例\" style=\"position:relative;\">functions/index.js のコード例</h2>\n<p><div id=\"gist100450553\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-functions_index-js\" class=\"file\">\n    \n\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper data type-javascript \">\n      \n<table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip>\n      <tr>\n        <td id=\"file-functions_index-js-L1\" class=\"blob-num js-line-number\" data-line-number=\"1\"></td>\n        <td id=\"file-functions_index-js-LC1\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>import</span> * <span class=pl-k>as</span> <span class=pl-s1>functions</span> <span class=pl-k>from</span> <span class=pl-s>&#39;firebase-functions&#39;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-functions_index-js-L2\" class=\"blob-num js-line-number\" data-line-number=\"2\"></td>\n        <td id=\"file-functions_index-js-LC2\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>import</span> * <span class=pl-k>as</span> <span class=pl-s1>admin</span> <span class=pl-k>from</span> <span class=pl-s>&#39;firebase-admin&#39;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-functions_index-js-L3\" class=\"blob-num js-line-number\" data-line-number=\"3\"></td>\n        <td id=\"file-functions_index-js-LC3\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-functions_index-js-L4\" class=\"blob-num js-line-number\" data-line-number=\"4\"></td>\n        <td id=\"file-functions_index-js-LC4\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-s1>admin</span><span class=pl-kos>.</span><span class=pl-en>initializeApp</span><span class=pl-kos>(</span><span class=pl-kos>{</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-functions_index-js-L5\" class=\"blob-num js-line-number\" data-line-number=\"5\"></td>\n        <td id=\"file-functions_index-js-LC5\" class=\"blob-code blob-code-inner js-file-line\">  <span class=pl-c1>credential</span>: <span class=pl-s1>admin</span><span class=pl-kos>.</span><span class=pl-c1>credential</span><span class=pl-kos>.</span><span class=pl-en>applicationDefault</span><span class=pl-kos>(</span><span class=pl-kos>)</span><span class=pl-kos>,</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-functions_index-js-L6\" class=\"blob-num js-line-number\" data-line-number=\"6\"></td>\n        <td id=\"file-functions_index-js-LC6\" class=\"blob-code blob-code-inner js-file-line\">  <span class=pl-c>// databaseURL: &#39;https://hoge.firebaseio.com/&#39;,</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-functions_index-js-L7\" class=\"blob-num js-line-number\" data-line-number=\"7\"></td>\n        <td id=\"file-functions_index-js-LC7\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-kos>}</span><span class=pl-kos>)</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-functions_index-js-L8\" class=\"blob-num js-line-number\" data-line-number=\"8\"></td>\n        <td id=\"file-functions_index-js-LC8\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-functions_index-js-L9\" class=\"blob-num js-line-number\" data-line-number=\"9\"></td>\n        <td id=\"file-functions_index-js-LC9\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>export</span> <span class=pl-k>const</span> <span class=pl-s1>api</span> <span class=pl-c1>=</span> <span class=pl-s1>functions</span><span class=pl-kos>.</span><span class=pl-c1>https</span><span class=pl-kos>.</span><span class=pl-en>onRequest</span><span class=pl-kos>(</span><span class=pl-k>async</span> <span class=pl-kos>(</span><span class=pl-s1>req</span><span class=pl-kos>,</span> <span class=pl-s1>res</span><span class=pl-kos>)</span> <span class=pl-c1>=&gt;</span> <span class=pl-kos>{</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-functions_index-js-L10\" class=\"blob-num js-line-number\" data-line-number=\"10\"></td>\n        <td id=\"file-functions_index-js-LC10\" class=\"blob-code blob-code-inner js-file-line\">  <span class=pl-k>const</span> <span class=pl-s1>message</span> <span class=pl-c1>=</span> <span class=pl-kos>{</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-functions_index-js-L11\" class=\"blob-num js-line-number\" data-line-number=\"11\"></td>\n        <td id=\"file-functions_index-js-LC11\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-c1>topic</span>: <span class=pl-s>&#39;TOPIC_NAME&#39;</span><span class=pl-kos>,</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-functions_index-js-L12\" class=\"blob-num js-line-number\" data-line-number=\"12\"></td>\n        <td id=\"file-functions_index-js-LC12\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-c1>notification</span>: <span class=pl-kos>{</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-functions_index-js-L13\" class=\"blob-num js-line-number\" data-line-number=\"13\"></td>\n        <td id=\"file-functions_index-js-LC13\" class=\"blob-code blob-code-inner js-file-line\">      <span class=pl-c1>title</span>: <span class=pl-s>&#39;通知デモです&#39;</span><span class=pl-kos>,</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-functions_index-js-L14\" class=\"blob-num js-line-number\" data-line-number=\"14\"></td>\n        <td id=\"file-functions_index-js-LC14\" class=\"blob-code blob-code-inner js-file-line\">      <span class=pl-c1>body</span>: <span class=pl-s>`サーバーは<span class=pl-s1><span class=pl-kos>${</span><span class=pl-k>new</span> <span class=pl-v>Date</span><span class=pl-kos>(</span><span class=pl-kos>)</span><span class=pl-kos>.</span><span class=pl-en>getHours</span><span class=pl-kos>(</span><span class=pl-kos>)</span><span class=pl-kos>}</span></span>時です。`</span><span class=pl-kos>,</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-functions_index-js-L15\" class=\"blob-num js-line-number\" data-line-number=\"15\"></td>\n        <td id=\"file-functions_index-js-LC15\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-kos>}</span><span class=pl-kos>,</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-functions_index-js-L16\" class=\"blob-num js-line-number\" data-line-number=\"16\"></td>\n        <td id=\"file-functions_index-js-LC16\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-c>// priority: &#39;high&#39;,</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-functions_index-js-L17\" class=\"blob-num js-line-number\" data-line-number=\"17\"></td>\n        <td id=\"file-functions_index-js-LC17\" class=\"blob-code blob-code-inner js-file-line\">  <span class=pl-kos>}</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-functions_index-js-L18\" class=\"blob-num js-line-number\" data-line-number=\"18\"></td>\n        <td id=\"file-functions_index-js-LC18\" class=\"blob-code blob-code-inner js-file-line\">  <span class=pl-s1>admin</span><span class=pl-kos>.</span><span class=pl-en>messaging</span><span class=pl-kos>(</span><span class=pl-kos>)</span><span class=pl-kos>.</span><span class=pl-en>send</span><span class=pl-kos>(</span><span class=pl-s1>message</span><span class=pl-kos>)</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-functions_index-js-L19\" class=\"blob-num js-line-number\" data-line-number=\"19\"></td>\n        <td id=\"file-functions_index-js-LC19\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-kos>}</span><span class=pl-kos>)</span></td>\n      </tr>\n</table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/elzup/66d33599362f232dfeb6f6c802718679/raw/c1f9271f17ca1e8c2786c86773285767a9f09a5c/functions_index.js\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/elzup/66d33599362f232dfeb6f6c802718679#file-functions_index-js\">functions_index.js</a>\n        hosted with &#10084; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div></p>\n<p>firestore などを使う場合は <code class=\"language-text\">databaseURL</code> オプションを設定する。</p>","frontmatter":{"title":"Firebase Function 内から Cloud Messaging で通知を投げる最小コード","date":"2020-01-08","tags":["Firebase","Firebase Cloud Messaging","GCP"]}}},"pageContext":{"slug":"firebase-messaging-by-function","previous":{"excerpt":"この記事では GatsbyJS で作っているブログのコードブロックをカスタマイズします。\n現状 Plain Text なので Syntax Hilight と style 調整をします。 手順 1. prismjs のプラグインを追加 gatsby-remark-prismjs…","fields":{"slug":"gatsby-codebrock"},"frontmatter":{"title":"GatsbyJSでコードブロックを作成する"}},"next":{"excerpt":"GatsbyJS で書いているこのブログを Typescript 移行しました。 主に以下の記事を参考に移行しました。なので今回は Type づけに焦点を当てて書きます。 Gatsby.js を完全 TypeScript 化する - Qiita GraphQL Data…","fields":{"slug":"gatsby-to-typescript"},"frontmatter":{"title":"GatsbyJS を Typescript に移行した際の Type 付け"}}}}}