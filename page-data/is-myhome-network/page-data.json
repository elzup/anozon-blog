{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/is-myhome-network","result":{"data":{"site":{"siteMetadata":{"title":"あのぞんブログ","author":"anozon","siteUrl":"https://blog.anozon.me"}},"markdownRemark":{"id":"0772b666-635d-5621-9ed4-7c9ac8748cc2","excerpt":"家のネットワーク上でだけ実行したいスクリプトがあったので、接続しているかチェックするコードを書きました。 network (npm) を使う 現在のネットワークを記録 比較する ファイルにストアする例 Home 設定 チェック 全体のコード network (npm) を使う tomas/network: The…","html":"<p>家のネットワーク上でだけ実行したいスクリプトがあったので、接続しているかチェックするコードを書きました。</p>\n<div class=\"toc\">\n<ul>\n<li>\n<p><a href=\"#network-npm-%E3%82%92%E4%BD%BF%E3%81%86\">network (npm) を使う</a></p>\n<ul>\n<li><a href=\"#%E7%8F%BE%E5%9C%A8%E3%81%AE%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%92%E8%A8%98%E9%8C%B2\">現在のネットワークを記録</a></li>\n<li><a href=\"#%E6%AF%94%E8%BC%83%E3%81%99%E3%82%8B\">比較する</a></li>\n<li>\n<p><a href=\"#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AB%E3%82%B9%E3%83%88%E3%82%A2%E3%81%99%E3%82%8B%E4%BE%8B\">ファイルにストアする例</a></p>\n<ul>\n<li><a href=\"#home-%E8%A8%AD%E5%AE%9A\">Home 設定</a></li>\n<li><a href=\"#%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF\">チェック</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#%E5%85%A8%E4%BD%93%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89\">全体のコード</a></li>\n</ul>\n</div>\n<h2 id=\"network-npm-を使う\">network (npm) を使う</h2>\n<p><a href=\"https://github.com/tomas/network\">tomas/network: The missing network utilities in Node.js.</a></p>\n<p>CLI でも以下のように確認できます。Mac, Linux, Windows 対応しているみたいです。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npx network active_interface\n{\n  name: &#39;en0&#39;,\n  type: &#39;Wireless&#39;,\n  ip_address: &#39;192.168.11.12&#39;,\n  mac_address: &#39;ff:ff:ff:01:ce:5b&#39;, // ここ\n  gateway_ip: &#39;192.168.11.1&#39;,\n  netmask: &#39;255.255.255.0&#39;\n}</code></pre></div>\n<h3 id=\"現在のネットワークを記録\">現在のネットワークを記録</h3>\n<p>今接続しているアクセスポイントの MAC アドレスを取得します。</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> promisify <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'util'</span>\n<span class=\"token keyword\">import</span> network <span class=\"token keyword\">from</span> <span class=\"token string\">'network'</span>\n\n<span class=\"token keyword\">const</span> getActiveInterface <span class=\"token operator\">=</span> <span class=\"token function\">promisify</span><span class=\"token punctuation\">(</span>network<span class=\"token punctuation\">.</span>get_active_interface<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getCurrent</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">await</span> <span class=\"token function\">getActiveInterface</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">?.</span>mac_address\n\n<span class=\"token keyword\">const</span> currntAccessPointMacAddress <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getCurrent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>currntAccessPointMacAddress<span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// ff:ff:ff:ff:ce:5b</span></code></pre></div>\n<h3 id=\"比較する\">比較する</h3>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">isSameNetwork</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>mac<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> mac <span class=\"token operator\">===</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">await</span> <span class=\"token function\">getCurrent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">HOME_MAC_ADDRESS</span> <span class=\"token operator\">=</span> <span class=\"token string\">'ff:ff:ff:ff:ce:5b'</span>\n\n<span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">await</span> <span class=\"token function\">isSameNetwork</span><span class=\"token punctuation\">(</span><span class=\"token constant\">HOME_MAC_ADDRESS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// true</span></code></pre></div>\n<h3 id=\"ファイルにストアする例\">ファイルにストアする例</h3>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> <span class=\"token constant\">SAVE_FILE</span> <span class=\"token operator\">=</span> <span class=\"token string\">'home.mac.txt'</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">saveHomeNetwork</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>id<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">writeFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'home.mac.txt'</span><span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">loadHomeNetwork</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token constant\">SAVE_FILE</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">isHomeNetwork</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">isSameNetwork</span><span class=\"token punctuation\">(</span><span class=\"token function\">loadHomeNetwork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h4 id=\"home-設定\">Home 設定</h4>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">setupHome</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> currntAccessPointMacAddress <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getCurrent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>currntAccessPointMacAddress<span class=\"token punctuation\">)</span>\n  <span class=\"token function\">saveHomeNetwork</span><span class=\"token punctuation\">(</span>currntAccessPointMacAddress<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4 id=\"チェック\">チェック</h4>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">await</span> <span class=\"token function\">isHomeNetwork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"全体のコード\">全体のコード</h2>\n<p>Gist: <a href=\"https://gist.github.com/elzup/a324b8d1129dc00d076870565670eea9\">Check is home Network</a></p>","frontmatter":{"title":"Node.js で家のネットワークかどうかチェックする","date":"2021-07-05","tags":["Node.js","Network"]}}},"pageContext":{"slug":"is-myhome-network","previous":{"excerpt":"Storybook で props 型が必要だけど export したくなかったので。 方法 1 方法 2(古い)","fields":{"slug":"get-props-type-from-component"},"frontmatter":{"title":"component から props の型を取得する"}},"next":{"excerpt":"CSR (Client side rendering) でユーザの public ip を取得する方法です。 ipify を使う ipify - A Simple Public IP Address API React hooks の例 Code: tools/global-ip…","fields":{"slug":"csr-get-public-ip"},"frontmatter":{"title":"ブラウザ javascript 側で global ip を取得する"}}}},"staticQueryHashes":["1855083372","2529228376","3070792728"]}