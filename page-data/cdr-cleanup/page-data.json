{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/cdr-cleanup","result":{"data":{"site":{"siteMetadata":{"title":"あのぞんブログ","author":"anozon"}},"markdownRemark":{"id":"14c6e15c-be5b-50d4-9852-bc78cb4aea46","excerpt":"この記事では cdr から不要なディレクトリを削除する方法を紹介します。 cdr は zsh に入っているコマンドで、過去に開いたディレクトリに移動できるコマンドです。 普段は  をラップした anyframe を使っています。\n過去のディレクトリに素早く移動できてはかどっています。 しかし cdr は rm や mv…","html":"<p>この記事では cdr から不要なディレクトリを削除する方法を紹介します。</p>\n<p>cdr は zsh に入っているコマンドで、過去に開いたディレクトリに移動できるコマンドです。</p>\n<p>普段は <code class=\"language-text\">cdr</code> をラップした <a href=\"https://github.com/mollifier/anyframe\">anyframe</a> を使っています。\n過去のディレクトリに素早く移動できてはかどっています。</p>\n<p>しかし cdr は rm や mv (rename) したディレクトリをキャッシュしていなくて残ってしまってるようです。</p>\n<p>そこでキャッシュから存在しないディレクトリを一掃してみます。</p>\n<h2>手順 1. キャッシュファイルの場所を確認する</h2>\n<p><code class=\"language-text\">$ zstyle</code> を実行して <code class=\"language-text\">recent-dirs-file</code> があればそこです。</p>\n<p>デフォルトは <code class=\"language-text\">~/.chpwd-recent-dirs</code> です。</p>\n<p><img src=\"https://elzup-image-storage.s3.amazonaws.com/blog/chpwd-recent-dirs.png\" alt=\"chpwd-recent-dirs\"></p>\n<p>なにやら見慣れぬ形式で入っていました。</p>\n<h2>手順 2. 削除するシェル</h2>\n<p>1 行ずつ「ディレクトリが存在するか？」を見ます。\nそして、無ければ消すシンプルなシェルを書きます。</p>\n<p>Gist: <a href=\"https://gist.github.com/elzup/4d36336470d18ae9e6216d5276f19cbd\">Clean no exists directories</a></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/sh</span>\n\n<span class=\"token function\">cat</span> ~/.chpwd-recent-dirs <span class=\"token punctuation\">\\</span>\n <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> -e <span class=\"token string\">'s/^..\\(.\\*\\)./<span class=\"token entity\" title=\"\\1\">\\1</span>/g'</span> <span class=\"token punctuation\">\\</span>\n <span class=\"token operator\">|</span> <span class=\"token keyword\">while</span> <span class=\"token builtin class-name\">read</span> line\n<span class=\"token keyword\">do</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> -d <span class=\"token string\">\"<span class=\"token variable\">$line</span>\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"\\$'\\<span class=\"token variable\">$line</span>'\"</span>\n<span class=\"token keyword\">fi</span>\n<span class=\"token keyword\">done</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">chmod</span> +x cdr-recent-dirs-clearn.sh\n$ <span class=\"token function\">bash</span> cdr-recent-dirs-clearn.sh <span class=\"token operator\">></span> .chpwd-recent-dirs-clearn\n$ vimdiff ~/.chpwd-recent-dirs .chpwd-recent-dirs-clearn</code></pre></div>\n<p>vimdiff で確認すると存在しないディレクトリがちゃんとなくなっていそうです。</p>\n<p><img src=\"https://elzup-image-storage.s3.amazonaws.com/blog/vimdiff-cdr-clean.png\" alt=\"vimdiff-cdr-clean.png\"></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">mv</span> .chpwd-recent-dirs-clearn ~/.chpwd-recent-dirs</code></pre></div>\n<p>よければ replace します。そして cdr に引っかかっていた 存在しないパスも消えました！</p>","frontmatter":{"title":"【zsh】cdr の掃除をする","date":"2020-01-21 17:00:00","tags":["zsh","DevOps"]}}},"pageContext":{"slug":"cdr-cleanup","previous":{"fields":{"slug":"zstyle-get-current-value"},"frontmatter":{"title":"zstyle で現在の値を取得する"}},"next":null}}}